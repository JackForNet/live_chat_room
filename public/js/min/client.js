/*!live-0.0.0.js 2016-06-15*/
!function(){var a,b=document,c=window,d=(parseInt,b.documentElement),e=b.body,f="CSS1Compat"==b.compatMode,g=f?d:e,h=(encodeURIComponent,0);c.CHAT={msgObj:b.getElementById("message"),screenheight:c.innerHeight?c.innerHeight:g.clientHeight,username:null,userid:null,socket:null,level:null,ip:null,allowChat:null,scrollToBottom:function(){c.scrollTo(0,this.msgObj.clientHeight)},logout:function(){location.reload()},replace_em:function(a){return a=a.replace(/\</g,"<;"),a=a.replace(/\>/g,">;"),a=a.replace(/\n/g,"<;br/>;"),a=a.replace(/\[em_([0-9]*)\]/g,'<img src="/face/$1.gif" border="0" />')},submit:function(){var c=$("#Y_iSend_Input").val();$("#Y_iSend_Input").val(CHAT.replace_em(c));var d=b.getElementById("Y_iSend_Input").value;if(""!=d&&0==h){var e,f,g=new Date,i=(new Date).getTime()+""+Math.floor(899*Math.random()+100),j=g.getFullYear()+"年"+(g.getMonth()+1)+"月"+g.getDate()+"日"+g.getHours()+":"+g.getMinutes();"http://chaxun.1616.net/s.php?type=ip&output=json&callback=?&_="+Math.random();if(""!=d){66!=this.level?(e=d,f=0):(e=d,f=1);var k={userid:this.userid,username:this.username,date:j,ip:$("#ip").val(),type:f,sendTo:$("#sel").find("option:selected").val(),sendToName:$("#sel").find("option:selected").text(),msgid:i,content:e,level:this.level}}this.socket.emit("checkmessage",k),b.getElementById("Y_iSend_Input").value="",h=1,a=setTimeout(function(){h=0},7e3)}else 1==h?(b.getElementById("Y_iSend_Input").value="",alert("发言过快!请稍后再试。")):alert("发送内容不能为空！");return!1},genUid:function(){return(new Date).getTime()+""+Math.floor(899*Math.random()+100)},updateSysMsg:function(a,c){var d=a.onlineUsers,e=(a.onlineCount,a.user,"");for(key in d)d.hasOwnProperty(key)&&(e+='<li><a><img width="25px" src="/images/'+d[key].level+'.png"/><span class="'+d[key].userid+'">'+d[key].nick_name+"</span></a></li>");var f='<option value="all">所有人</option>';$("#sel").html(f),$("#User_List").html(e),$("#userlist").mCustomScrollbar("update"),$("#userlist").mCustomScrollbar("scrollTo","last");var g="";g+='<li class="chatli"><span class="b">',g+=a.user.nick_name,g+="login"==c?" 加入了聊天室":" 退出了聊天室",g+="</span></li>";var h=b.createElement("li");this.genUid();h.className="system J-mjrlinkWrap J-cutMsg"},usernameSubmit:function(){var a=this.genUid();return""!=a&&this.init(a),!1},delmesli:function(a){this.socket.emit("delmessage",a)},passmesli:function(a){this.socket.emit("passmessage",a)},checkCookie:function(){var a=getCookie("userid");null!=a&&""!=a&&setCookie("userid",this.userid)},getCookie:function(a){if(document.cookie.length>0){var b=document.cookie.indexOf(a+"=");if(-1!=b){b=b+a.length+1;var c=document.cookie.indexOf(";",b);return-1==c&&(c=document.cookie.length),unescape(document.cookie.substring(b,c))}}return""},setCookie:function(a,b){document.cookie=a+"="+escape(b)},init:function(a){if("77"==$("#userlevel").val()){var c=CHAT.getCookie("userid"),d=CHAT.getCookie("id");if(null!=c&&""!=c&&""!=d&&null!=d)$("#dd2").text("游客_"+c),$("#userid").val(d),this.username="游客_"+c;else{var e=(new Date).getTime()+""+Math.floor(899*Math.random()+100),c=Math.floor(900*Math.random());$("#dd2").text("游客_"+c),$("#userid").val(e),this.username="游客_"+c,document.cookie="userid="+c,document.cookie="id="+e}}this.userid=$("#userid").val(),this.username=$("#regBt span").text(),this.level=$("#userlevel").val(),this.allowChat=$("#allowChat").html(),this.scrollToBottom(),this.socket=io.connect("ws://139.196.203.21:3000"),this.socket.emit("login",{_id:this.userid,nick_name:this.username,level:this.level}),this.socket.on("login",function(a){CHAT.updateSysMsg(a,"login")}),this.socket.on("logout",function(a){CHAT.updateSysMsg(a,"logout")}),this.socket.on("fabugonggao",function(a){$("#gonggao").html(a.gonggao),$("#gundongspan").html(a.gonggao)}),this.socket.on("fabuhandan",function(a){$("#dkqs").html(a.dkqs),$("#kcdw").html(a.kcdw),$("#pcdw").html(a.pcdw),$("#zsdw").html(a.zsdw),$("#zydw").html(a.zydw),$("#bz").html(a.bz),$("#hduser").html(a.hduser),$("#hdtime").html(a.hdtime)}),this.socket.on("delmessage",function(a){$("#message").find("li[title="+a+"]").remove()}),this.socket.on("check_message",function(a){var c=(new Date,a.userid==CHAT.userid),d=a.date.substring(a.date.indexOf("日")+1,a.date.length),e='<span class="a">'+d+"</span>",f='<img class="Role Manager2" src="/images/'+a.level+'.png">',g='<a class="u">'+a.username+"</a>";g+='<img src="/images/r-middle-pic_chat.png"/><a>'+a.sendToName+"</a>";var h='<p class="b">'+a.content;66==CHAT.level&&(h+="<img src='/images/Delete.png' onclick=CHAT.delmesli('"+a.msgid+"') value=''/><img id='"+a.msgid+"' src='/images/pass.png' onclick=CHAT.passmesli('"+a.msgid+"') value=''/>"),h+="</p>";var i=b.createElement("li");i.title=a.msgid,c?(i.className="user",i.innerHTML=e+f+g+h):(i.className="service",i.innerHTML=e+f+g+h),(66==CHAT.level||c)&&CHAT.msgObj.appendChild(i),$("#Y_PubMes_Div").mCustomScrollbar("update"),$("#Y_PubMes_Div").mCustomScrollbar("scrollTo","last")}),this.socket.on("message",function(a){var c=(new Date,a.userid==CHAT.userid),d=a.date.substring(a.date.indexOf("日")+1,a.date.length),e='<span class="a">'+d+"</span>",f='<img class="Role Manager2" src="/images/'+a.level+'.png">',g='<a class="u">'+a.username+"：</a>",h='<p class="b">'+a.content;""!=a.sendToName&&(g+='<img src="/images/r-middle-pic_chat.png"/><a>'+a.sendToName+"</a>");var h='<p class="b">'+a.content;if(66==CHAT.level){a.msgId;h+="<img src='/images/Delete.png' onclick=CHAT.delmesli('"+a.msgid+"') value=''/>"}h+="</p>",4==a.type&&66==CHAT.level&&$("#"+a.msgid).remove();var i=b.createElement("li");i.title=a.msgid,c?66==CHAT.level?(i.className="teacher",i.innerHTML=e+f+g+h,CHAT.msgObj.appendChild(i)):(i.className="user",i.innerHTML=e+f+g+h):66!=CHAT.level&&(a.sendToName!=CHAT.username&&"所有人"!=a.sendToName||(i.className="service",i.innerHTML=e+f+g+h,CHAT.msgObj.appendChild(i))),$("#Y_PubMes_Div").mCustomScrollbar("update"),$("#Y_PubMes_Div").mCustomScrollbar("scrollTo","last")})}},b.getElementById("Y_iSend_Input").onkeydown=function(a){a=a||event,13===a.keyCode&&CHAT.submit()}}();